<!doctype html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="utf-8"/>
  <title>마이페이지</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/style.css">
  <style>
    /* 헤더가 fixed-top이면 본문이 가려지지 않도록 보정 */
    :root { --header-h: 0px; }               /* 필요시 높이 조정 */
    body.has-fixed-header { padding-top: var(--header-h); }

    /* 페이지 상단 여백 (헤더와 제목 사이) */
    .page-title { margin-top: 1.25rem; }      /* = mt-4 근처 */

    /* 탭 스타일은 유지 */
    .pill-tabs{background:#f2eef9;border-radius:30px;padding:10px 12px}
    .pill-tab{border-radius:999px;padding:.6rem 1rem;border:none;background:transparent;font-weight:600;opacity:.6}
    .pill-tab.active{background:white;box-shadow:0 4px 16px rgba(0,0,0,.06);opacity:1}
  </style>
</head>

<body class="d-flex flex-column min-vh-100 has-fixed-header">
  <header th:replace="fragments/header :: site-header"></header>

  <!-- 메인 컨테이너 (flex-grow-1로 공간 차지) -->
  <main class="container flex-grow-1 py-3">

    <h3 class="fw-bold mb-1 page-title">마이페이지</h3>
    <div class="text-muted mb-3">고객님과 관련된 정보 페이지입니다.</div>

    <div th:if="${msg}" class="alert alert-success" th:text="${msg}"></div>

    <!-- 탭 -->
    <div class="pill-tabs d-flex justify-content-evenly mb-4">
      <a th:classappend="${view.activeTab=='qna'}? ' active'" class="pill-tab btn"
         th:href="@{/mypage(tab='qna')}">내 문의내역</a>
      <a th:classappend="${view.activeTab=='profile'}? ' active'" class="pill-tab btn"
         th:href="@{/mypage(tab='profile')}">내 정보 수정</a>
      <a th:classappend="${view.activeTab=='wordbook'}? ' active'" class="pill-tab btn"
         th:href="@{/mypage(tab='wordbook')}">내 단어장</a>
    </div>

    <!-- 문의내역 (아코디언 버전을 쓰는 경우) -->
    <div th:if="${view.activeTab=='qna'}">
      <div class="accordion" id="qnaAccordion" th:with="page=${qnaAccordionPage}">
        <div class="accordion-item" th:each="row : ${page.content}">
          <h2 class="accordion-header" th:attr="id=${'qna-h-'+row.id()}">
            <button class="accordion-button collapsed" type="button"
                    data-bs-toggle="collapse"
                    th:attr="data-bs-target=${'#qna-c-'+row.id()}"
                    aria-expanded="false"
                    th:attrappend="aria-controls=${'qna-c-'+row.id()}">
              <span class="me-2 badge"
                    th:classappend="${row.answerContent()!=null} ? 'bg-success' : 'bg-secondary'"
                    th:text="${row.answerContent()!=null} ? '답변완료' : '답변대기'">상태</span>
              <span th:text="${row.title()}">제목</span>
              <small class="ms-auto text-muted"
                     th:text="${#temporals.format(row.createdAt(),'yyyy-MM-dd HH:mm')}">2025-09-14</small>
            </button>
          </h2>
          <div class="accordion-collapse collapse"
               th:attr="id=${'qna-c-'+row.id()}"
               th:attrappend="aria-labelledby=${'qna-h-'+row.id()}"
               data-bs-parent="#qnaAccordion">
            <div class="accordion-body">
              <div class="mb-3">
                <div class="fw-bold mb-1">질문 내용</div>
                <div class="border rounded p-2 bg-light" th:text="${row.content()}">본문</div>
              </div>
              <div>
                <div class="fw-bold mb-1">답변</div>
                <div th:if="${row.answerContent()!=null}">
                  <div class="border rounded p-2" th:text="${row.answerContent()}">답변 본문</div>
                </div>
                <div class="text-muted" th:if="${row.answerContent()==null}">
                  아직 등록된 답변이 없습니다.
                </div>
              </div>
              <div class="mt-3 d-flex gap-2">
                <a class="btn btn-sm btn-outline-secondary" th:href="@{'/qna/' + ${row.id()}}">상세보기</a>
              </div>
            </div>
          </div>
        </div>

        <!-- 페이지네이션 -->
        <nav class="mt-3" th:if="${page.totalPages > 1}">
          <ul class="pagination">
            <li class="page-item" th:classappend="${page.first}? 'disabled'">
              <a class="page-link" th:href="@{/mypage(tab='qna', page=${page.number-1}, size=${page.size})}">이전</a>
            </li>
            <li class="page-item" th:each="i : ${#numbers.sequence(0, page.totalPages-1)}"
                th:classappend="${i==page.number}? 'active'">
              <a class="page-link" th:text="${i+1}"
                 th:href="@{/mypage(tab='qna', page=${i}, size=${page.size})}">1</a>
            </li>
            <li class="page-item" th:classappend="${page.last}? 'disabled'">
              <a class="page-link" th:href="@{/mypage(tab='qna', page=${page.number+1}, size=${page.size})}">다음</a>
            </li>
          </ul>
        </nav>
      </div>
    </div>

<!-- 내 정보 수정 -->
<style>
  /* ===== Profile form style (스샷 느낌) ===== */
  .profile-wrap{display:flex;justify-content:center}
  .profile-card{
    width: min(860px, 100%);
    margin: 16px auto 40px;
    padding: 48px 36px;
    background:#fff;
    border-radius:24px;
    box-shadow:0 12px 32px rgba(0,0,0,.06);
  }
  .profile-title{
    font-weight:800;
    font-size:20px;
    text-align:center;
    margin-bottom:28px;
  }
  .profile-label{font-weight:600;color:#555;margin-bottom:8px}
  .profile-input{
    height:48px;
    border-radius:10px;
    background:#f6f6f8;
    border:1px solid #ececf1;
    padding:10px 14px;
  }
  .profile-input:focus{
    outline:none;
    border-color:#b9b4ff;
    box-shadow:0 0 0 4px rgba(141,116,255,.12);
    background:#fff;
  }
  .btn-mint{
    background:#bff0c8;  /* 연한 민트 */
    border:none;
    font-weight:700;
  }
  .btn-mint:hover{filter:brightness(.96)}
  .btn-black{
    background:#111; color:#fff; border:none; font-weight:700;
  }
  .btn-black:hover{filter:brightness(1.05)}
  .btn-danger-outline{
    border:1px solid #ef4e4e; color:#ef4e4e; background:transparent;
  }
  .btn-danger-outline:hover{background:#ffefef}
  .row-gap-20 > .col-12{margin-bottom:20px}
</style>

<div th:if="${view.activeTab=='profile'}" class="profile-wrap">
  <div class="profile-card">
    <div class="profile-title">회원 정보 수정</div>

    <form th:action="@{/mypage/update}" method="post" th:object="${form}">
      <div class="row row-gap-20">
        <div class="col-12">
          <label class="profile-label">이메일 *</label>
          <input class="form-control profile-input" th:field="*{email}" placeholder="example@toke.com">
          <div class="text-danger small mt-1" th:errors="*{email}"></div>
        </div>

        <div class="col-12">
          <label class="profile-label">별명(닉네임) *</label>
          <input class="form-control profile-input" th:field="*{nickname}" placeholder="6자 이내">
          <div class="text-danger small mt-1" th:errors="*{nickname}"></div>
        </div>

        <div class="col-12">
          <label class="profile-label">전화번호 *</label>
          <input class="form-control profile-input" th:field="*{phoneNumber}" placeholder="하이픈 없이 숫자만">
          <div class="text-danger small mt-1" th:errors="*{phoneNumber}"></div>
        </div>
      </div>

      <!-- 버튼 영역 -->
      <div class="d-flex gap-3 justify-content-center mt-4">
        <button type="submit" class="btn btn-mint px-5 py-2 rounded-4">수정</button>
        <button type="reset" class="btn btn-black px-5 py-2 rounded-4"
                onclick="history.back();return false;">취소</button>
      </div>
    </form>

    <!-- 탈퇴 -->
    <form th:action="@{/mypage/delete}" method="post" class="d-flex justify-content-center mt-4"
          onsubmit="return confirm('정말 탈퇴하시겠습니까? 복구할 수 없습니다.');">
      <button type="submit" class="btn btn-danger-outline rounded-4 px-4">회원탈퇴</button>
    </form>
  </div>
</div>

    <!-- 내 단어장 -->
    <div th:if="${view.activeTab=='wordbook'}" class="row g-3">
      <div class="col-12 col-md-6 col-lg-4" th:each="w : ${view.wordbooks}">
        <div class="card h-100">
          <div class="card-body">
            <h5 th:text="${w.title}">단어장 이름</h5>
            <p th:text="${w.description}">단어장 설명</p>
            <div class="d-flex flex-wrap gap-1">
              <span class="badge bg-primary" th:each="t : ${w.tags}" th:text="${t}">태그</span>
            </div>
          </div>
        </div>
      </div>
    </div>

  </main>

  <!-- ✅ 푸터: 항상 하단 고정 (flex + mt-auto) -->
  <footer th:insert="fragments/footer :: site-footer" class="mt-auto"></footer>

  <!-- Bootstrap JS (아코디언 동작용) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
