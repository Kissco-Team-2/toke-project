<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
<meta charset="UTF-8">
<title>비즈니스 일본어 표현</title>
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
	rel="stylesheet">

<style>
body {

	font-family: "Noto Sans KR", sans-serif;
}

.tab-btn {
	background: #000;
	color: #fff;
	font-weight: 400;
	border: 0;
	border-radius: 6px;
	padding: 10px;
	white-space: nowrap;
	text-decoration: none;
	/* flex:1 제거 */
}

.tab-btn.active {
	background: #A6B4FF !important;
}

.btn-soft-green {
	background: #caf7cf;
	color: #000;
	border: 0;
	font-weight: 600;
}

.btn-soft-green:hover {
	background: #bfe3ce;
	color: #0f5132;
}

.word-box {
	background: #fff;
	border-radius: 16px;
	padding: 1rem;
	box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
	max-height: 400px; /* 목록 높이 제한 */
	overflow-y: hidden; /* 넘치면 hidden */
	position: relative;
}

.word-row {
	display: flex;
	padding: 0.8rem 0;
	border-bottom: 1px solid #eee;
	gap: 4rem;
}

.word-ja {
	flex: 2;
}

.word-ka {
	flex: 2;
}

.word-ko {
	flex: 2;
	color: #333;
}

.word-ex {
	flex: 4;
	color: #555;
	font-size: 0.95rem;
}

/* 스크롤 버튼 (목록 바깥에 위치) */
.scroll-btn {
	color: #fff;
	background: #d9d9d9;
	border-radius: 50%;
	width: 36px;
	height: 36px;
	display: flex;
	justify-content: center;
	align-items: center;
	cursor: pointer;
	box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
}

.index-link {
	margin: 0 .5rem;
	color: #aaa;
	text-decoration: none;
	font-weight: 500;
	font-size: 1rem;
}

.index-link:hover {
	color: #000;
	font-weight: 600;
}

.index-link.active {
	color: #000;
	font-weight: 700;
	text-decoration: underline;
}
</style>
</head>
<body class="d-flex flex-column min-vh-100" style="margin: 0;">

	<header th:replace="fragments/header :: site-header"></header>

	<main class="flex-grow-1" style="margin: 0; padding: 0;">

		<h2 class="mb-4 text-center fw-bold" style="margin-top: 3rem;">비즈니스
			일본어 표현</h2>

		<!-- 검색 -->
		<div class="d-flex justify-content-center mb-3">
			<form method="get" th:action="@{/words}" class="d-flex w-25">
				<input type="text" name="q" th:value="${q}"
					class="form-control me-2"> <input type="hidden" name="mode"
					th:value="${mode}">
				<button class="btn btn-soft-green" style="width: 100px">검색</button>
			</form>
		</div>


		<!-- 정렬 탭 -->
		<div class="container" style="padding: 20px;">
			<div class="d-flex justify-content-between">
				<div class="d-flex gap-2 mb-3">
					<a th:href="@{/words(mode='ko', q=${q}, category=${category})}"
						class="tab-btn" th:classappend="${mode=='ko'}? ' active'">가나다순</a>
					<a th:href="@{/words(mode='ja', q=${q}, category=${category})}"
						class="tab-btn" th:classappend="${mode=='ja'}? ' active'">히라가나순</a>
					<a th:href="@{/words(mode='cat', q=${q})}" class="tab-btn"
						th:classappend="${mode=='cat'}? ' active'">카테고리별</a> <a
						th:href="@{/words(mode='recent', q=${q}, category=${category})}"
						class="tab-btn" th:classappend="${mode=='recent'}? ' active'">최근
						등록순</a>


				</div>
				<button class="btn btn-black m-2" data-bs-toggle="modal"
					data-bs-target="#add_to_mylist_modal">내 단어장에 추가</button>
			</div>


			<!-- 목록 박스 -->
			<div class="container p-2">

				<!-- 한글 인덱스: 가나다순 모드일 때만 -->
				<div th:if="${mode == 'ko'}" class="hangeul-index mb-3">
					<a th:each="g : ${'가,나,다,라,마,바,사,아,자,차,카,타,파,하'.split(',')}"
						th:href="@{/words(mode='ko', group=${g}, q=${q}, category=${category})}"
						th:text="${g}" class="index-link"
						th:classappend="${group==g}?'fw-bold text-dark selected':''"></a>
				</div>

				<!-- 일본어 인덱스: 히라가나순 모드일 때만 -->
				<div th:if="${mode == 'ja'}" class="kana-index mb-3">
					<a th:each="g : ${'あ,か,さ,た,な,は,ま,や,ら,わ'.split(',')}"
						th:href="@{/words(mode='ja', group=${g}, q=${q}, category=${category})}"
						th:text="${g}" class="index-link"
						th:classappend="${group==g}?'fw-bold text-dark selected':''"></a>
				</div>

				<div th:if="${mode == 'cat'}" class="category-index mb-3">
					<a th:each="c : ${'고객 대응,메일,보고,인사,전화,제안,회의'.split(',')}"
						th:href="@{/words(mode='cat', category=${c}, q=${q})}"
						th:text="${c}" class="index-link"
						th:classappend="${category==c}?'fw-bold text-dark selected':''"></a>
				</div>

				<div class="word-box" id="wordBox">


					<div class="p-2">
						<div th:each="w : ${words}" class="word-row m-2">
							<div class="word-ja" th:text="${w.japaneseWord}">ご連絡ありがとうございます。</div>
							<div class="word-ka" th:text="${w.readingKana}">ごれんらくありがとうございます。</div>
							<div class="word-ko" th:text="${w.koreanMeaning}">연락 감사합니다.</div>
							<div class="word-ex" th:text="${w.exampleSentenceJp}">送っていただいた資料を確認しました。</div>
							<div class="form-check ms-auto">
								<input class="form-check-input circle-checkbox" type="checkbox"
									name="selectedWords" th:value="${w.id}">
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>


		<!-- 스크롤 버튼 -->
		<!-- 버튼 그룹 -->
		<div class="d-flex justify-content-center"
			style="margin-bottom: 2rem; gap: 16px;">
			<div class="scroll-btn" onclick="scrollUp()">▲</div>
			<div class="scroll-btn" onclick="scrollDown()">▼</div>
		</div>

		<div th:replace="fragments/add_to_mylist_modal :: add_to_mylist_modal"></div>

	</main>
	<footer th:replace="fragments/footer :: site-footer"
		style="margin-top: 0; padding-top: 0; background: #000;"></footer>

	<script>
		function scrollDown() {
			const box = document.getElementById('wordBox');
			box.scrollBy({
				top : 120,
				behavior : 'smooth'
			});
		}

		function scrollUp() {
			const box = document.getElementById('wordBox');
			box.scrollBy({
				top : -120,
				behavior : 'smooth'
			});
		}
	</script>
	<script>
document.getElementById('add_to_mylist_modal')
  .addEventListener('show.bs.modal', function () {
    const checked = document.querySelectorAll('input[name="selectedWords"]:checked');
    const ids = Array.from(checked).map(cb => cb.value);
    document.getElementById('selectedWordIds').value = ids.join(',');
  });
</script>

<script>
  // 모달이 열릴 때 선택된 체크박스들을 모아서 selectedWordIds에 채우는 기존 코드
  document.getElementById('add_to_mylist_modal')
    .addEventListener('show.bs.modal', function () {
      const checked = document.querySelectorAll('input[name="selectedWords"]:checked');
      const ids = Array.from(checked).map(cb => cb.value);
      const hidden = document.getElementById('selectedWordIds');
      if (hidden) hidden.value = ids.join(',');
  });

  // 실제 제출 전에 검사: 비어있으면 alert 띄우고 제출 막음
  const addForm = document.getElementById('addToMyListForm'); // 모달 안의 form id
  if (addForm) {
    addForm.addEventListener('submit', function(e) {
      const hidden = document.getElementById('selectedWordIds');
      const ids = hidden ? hidden.value.trim() : '';
      if (!ids) {
        e.preventDefault();
        alert('선택된 단어가 없습니다. 추가할 단어를 선택해 주세요');
        // 모달 닫지 않음, 사용자가 선택하도록 함
      }
    });
  }
</script>

	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
