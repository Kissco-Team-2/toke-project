<!doctype html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>퀴즈 결과</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/style.css">
  <style>
    :root{--ok:#22c55e;--no:#ef4444;--muted:#6b7280;--pill:#E7E9FF}
    body{background:#fff}
    .page-title{font-weight:800;letter-spacing:.02em;text-align:center}
    .topbar{display:flex;align-items:center;justify-content:space-between;gap:12px}
    .meta{color:var(--muted)}
    .score-pill{border:1px solid #e5e7eb;border-radius:999px;padding:.25rem .65rem}
    .q-rail{display:flex;align-items:center;justify-content:center;gap:6px}
    .qdot{width:28px;height:28px;border-radius:8px;border:1px solid #dcdcdc;display:flex;align-items:center;justify-content:center;font-size:14px}
    .qdot.ok{border-color:var(--ok);color:var(--ok)}
    .qdot.no{border-color:var(--no);color:var(--no)}
    .qbox{border:1px solid #eee;border-radius:18px;padding:20px}
    .qcircle{width:36px;height:36px;border-radius:50%;border:2px solid #111;display:inline-flex;align-items:center;justify-content:center;font-weight:800;margin-right:10px}
    .mark{font-weight:900;font-size:20px}
    .mark.ok{color:var(--ok)}
    .mark.no{color:var(--no)}
    .opt{display:flex;gap:.6rem;align-items:center;padding:8px 10px;border-radius:10px;border:1px solid #f0f0f0;margin-bottom:8px}
    .dot{width:10px;height:10px;border-radius:50%;background:#cfd4dc}
    .opt.correct .dot{background:var(--ok)}
    .opt.wrong   .dot{background:var(--no)}
    .opt.wrong .picked::after{content:'✔';margin-left:6px;color:var(--no);font-weight:800}
    .hdr{background:var(--pill);border-radius:16px;padding:.6rem 1rem;margin:1rem 0 .75rem}
    .explain{color:var(--muted)}
    footer{display:none}
  </style>
</head>
<body class="container py-4">

<header th:replace="fragments/header :: site-header"></header>

<!-- 상단 -->
<div class="mb-3">
  <h2 class="page-title mb-3">퀴즈 결과</h2>
  <div class="topbar">
    <div class="meta">
      <span th:text="|총 ${result.total}문제 중 ${result.correct}문제를 맞혔습니다.|">총 10문제 중 8문제를 맞혔습니다.</span>
      <span class="ms-2 score-pill" th:text="|+${result.correct}점|">+8점</span>
    </div>
    <div class="form-check form-switch">
      <input class="form-check-input" type="checkbox" id="wrongOnly">
      <label class="form-check-label" for="wrongOnly">오답만 보기</label>
    </div>
  </div>
</div>

<!-- 인덱스 바 (1…10) -->
<div class="q-rail mb-3">
  <span class="qdot"
        th:each="q : ${result.items}"
        th:text="${q.index()+1}"
        th:classappend="${q.isCorrect()} ? ' ok' : ' no'">1</span>
</div>

<!-- 헤더 라인 (큰 화면에서만) -->
<div class="hdr d-none d-md-grid" style="grid-template-columns: 1fr 1fr 1fr;">
  <div class="fw-semibold">문항</div>
  <div class="fw-semibold">선택지</div>
  <div class="fw-semibold">해설</div>
</div>

<!-- 결과 카드들 -->
<div id="cards" class="vstack gap-3">
  <div class="qbox" th:each="q : ${result.items}"
       th:classappend="${q.isCorrect()} ? 'is-correct' : 'is-wrong'">

    <!-- 타이틀 열 -->
    <div class="d-flex justify-content-between align-items-center mb-2">
      <div>
        <span class="fw-bold me-2" th:text="|Q${q.index()+1}|">Q1</span>
        <span class="fw-semibold" th:text="${q.prompt()}">질문</span>
      </div>
      <div>
        <span class="mark ok" th:if="${q.isCorrect()}">✓</span>
        <span class="mark no" th:if="${!q.isCorrect()}">✗</span>
      </div>
    </div>

    <!-- 본문: 선택지 + 해설 -->
    <div class="row g-3">
      <div class="col-md-6">
        <ul class="list-unstyled mb-0">
          <li class="opt"
              th:each="opt, iStat : ${q.options()}"
              th:classappend="${ iStat.index == q.correctIndex() ? ' correct' : ((q.userSelected() != null and iStat.index == q.userSelected()) ? ' wrong' : '') }">
            <span class="dot"></span>
            <span th:text="${opt}" th:classappend="${q.userSelected() != null and iStat.index == q.userSelected()} ? ' picked' : ''">보기</span>
          </li>
        </ul>
      </div>
      <div class="col-md-6">
        <div class="explain small">
          <div>
            정답:
            <span class="fw-semibold" th:text="${q.options().get(q.correctIndex())}">정답</span>
            <span class="text-muted ms-2" th:if="${q.userSelected() != null}">
              (내 답: <span th:text="${q.options().get(q.userSelected())}">내답</span>)
            </span>
          </div>
          <div class="mt-1"
          			th:text="${q.explain() != null && !#strings.isEmpty(q.explain()) 
                ? q.explain() 
                : '해설: 정답을 중심으로 의미 차이를 확인해 보세요.'}">
   					 해설: 정답을 중심으로 의미 차이를 확인해 보세요.
 		 </div>
 		  <div class="mt-1" th:if="${q.exampleSentenceJp() != null && !#strings.isEmpty(q.exampleSentenceJp())}">
   				 예문: <span th:text="${q.exampleSentenceJp()}"></span>
  			</div>
        </div>
      </div>
    </div>

  </div>
</div>

<!-- 하단 버튼 -->
<div class="d-flex align-items-center justify-content-between mt-4">
  <a class="btn btn-outline-secondary" th:href="@{/words}">표현목록으로 바로가기</a>
  <a class="btn btn-dark" th:href="@{/wrong-notes}">오답노트로 바로가기</a>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
  // 오답만 보기 토글
  const togg = document.getElementById('wrongOnly');
  const cards = document.getElementById('cards');
  togg.addEventListener('change', ()=> {
    const only = togg.checked;
    cards.querySelectorAll('.qbox').forEach(c=>{
      const wrong = c.classList.contains('is-wrong');
      c.style.display = (only && !wrong) ? 'none' : '';
    });
  });
</script>
</body>
</html>
